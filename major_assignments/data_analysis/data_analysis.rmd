---
title: "data analysis"
author: "Kate Seltzer and Mike Charles"
date: "4/16/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
```

##Read in data
```{r}
board_games_20 <- read_csv("C:\\Users\\kates\\OneDrive\\Documents\\data\\2020.csv")

board_games_21 <- read_csv("C:\\Users\\kates\\OneDrive\\Documents\\data\\2021.csv")

detailed_games <- read_csv("C:\\Users\\kates\\OneDrive\\Documents\\data\\games_detailed_info.csv")

bgg_15 <- read_csv("C:\\Users\\kates\\OneDrive\\Documents\\data\\bgg-15m-reviews.csv")

bgg_19 <- read_csv("C:\\Users\\kates\\OneDrive\\Documents\\data\\bgg-19m-reviews.csv")
```
##About the data
We've created two dataframes that contain board game rankings from 2020 and 2021. They each contain the game ranking, its average score, and the year it came out. Other data available describes the games in detail, including a brief summary of the game itself. That last set will allow us to find patterns in games based on their genre. The dataframes based on 2020 and 2021 have 10 columns and 19,330 and 21,831 rows respectively -- off the bat we should be mindful of that and know it won't be a perfect comparison between two years. Although there's some basis for comparison, because we don't have access to many years before the pandemic, it might be difficult to answer the question about how COVID-19 has impacted game choice. We also have the data for specific game reviews -- literal comments people have left about the games. That's maybe not the most helpful from a data anaylsis perspective, but once we have more information about which games are popular, it would be helpful to have that anecdotal evidence to determine why.

```{r}
#clean data to get rid of random characters
#use this to determine how many games were in the top 100 in 2021 but not in 2020 

board_games_20 <- board_games_20 %>%
  mutate(key=str_to_upper(Name)) %>% 
  mutate(key=str_replace_all(key,":" , "")) %>%  
  mutate(key=str_replace_all(key," " , "")) %>% 
  mutate(key=str_replace_all(key,"()" , "")) %>%
  mutate(key=str_replace_all(key,",", "")) %>% 
  mutate(data_year =2020) %>% 
  group_by(key) %>% 
  arrange(Rank) %>% 
  head(100) %>% 
  arrange(Year)

board_games_21 <- board_games_21 %>%
  mutate(key=str_to_upper(Name)) %>% 
  mutate(key=str_replace_all(key,":" , "")) %>%  
  mutate(key=str_replace_all(key," " , "")) %>% 
  mutate(key=str_replace_all(key,"()" , "")) %>%
  mutate(key=str_replace_all(key,",", "")) %>% 
  mutate(data_year =2020) %>% 
  mutate(data_year =2021) %>% 
  group_by(key) %>% 
  arrange(Rank) %>% 
  head(100) %>% 
  arrange(Year)


```


```{r}
#use this to do side by side comparison of board games ranked between 2020 and 2021
compare_20_21 <-
  bind_rows(board_games_20,board_games_21) 


compare_20_21 <- compare_20_21 %>% 
  select(key, Rank, data_year)%>%
  pivot_wider(names_from = data_year, values_from = Rank)
```

```{r}
#filter by top 10 ish games for comments (run several filters here)
pandemic_comments <- bgg_19 %>% 
  filter(name == Pandemic & rating == 10) %>% 
  head(10)
  
```



```{r}
#are users who leave positive reviews reviewing certain kinds of games? 
users_19 <- bgg_19%>%
  group_by(user) %>%
  summarise(avg_rating = mean(rating), reviews = n()) %>%
  arrange(desc(reviews)) %>% 
  head(10)

```


```{r}
#maybe: text analysis of positive vs negative reviews
select(comment) %>%
  unnest_tokens(word, comment)
View(unique_words)
```


## Some questions answered by this code

1. What were the top 10 games of 2020 and 2021?
2020: Gloomhaven, Pandemic Legacy: Season 1, Brass: Birmingham, Terraforming Mars, Twilight Imperium (Fourth Edition), Through the Ages: A New Story of Civilization, Gaia Project, Star Wars: Rebellion, Twilight Struggle, Great Western Trail

2021: Gloomhaven, Pandemic Legacy: Season 1, Brass: Birmingham, Terraforming Mars, Twilight Imperium: Fourth Edition, Gloomhaven: Jaws of the Lion, Gaia Project, Star Wars: Rebellion, Through the Ages: A New Story of Civilization, War of the Ring: Second Edition

2. Of the top 100 games 2021, how many were new to the list (i.e., did not appear on the 2020 top 100 list)?

(Need to clean data)

Note: We think the way to look at this would be to filter by is.na, but we couldn't quite get that code to work, so this is based on a 114 row dataframe for the comparison. 

3. Do certain users give specifically good or specifically bad reviews? 

We filtered all users and found the average rating they gave certain games to determine if certain users were prone to more positive or negative reviews. We also counted how many reviews each specific user gave. The average rating by all of the users who left 100 or more reviews was 10.

```{r}

```

##NARRATIVE
Research shows that in the first year of the pandemic, board game sales skyrocked -- according to the Guardian, in the first week of the official coronavirus lockdown, board game and puzzle sales in the UK rose 240%. 

Though the number of board games sold rose over the course of the pandemic, games that were popular in 2020 tended to be popular in 2021. Versions of Gloomhaven, Pandemic, Brass, Terraforming and Twilight Imperium all appeared in the top five most popular games, according to a dataset from Board Game Geek. 

In general, players preferred newer games. Of the top 100 most popular games in 2020 and 2021, 82 had been released in the last decade. There are some outliers, however: Crokinole, ranked 67th in 2020 and 62nd in 2021, was released in 1876. 

[Would like to include a few grafs here about what people liked about games based on reviews, but having some trouble with the filters. There's also room for text analysis with the reviews, but R crashed when we tried it -- maybe the file's just too big?]

**some analysis about user reviews

With this set of code, we were attempting to determine the average review score left by individuals on Board Game Geek. In order to do this, we grouped each user together to further organize the data. From there, we calculated the average rating of these users and determined that the average score was 10 out of 10. This tells us that regardless of the amount of reviews individuals put in, they are most likely to give a 10. This may be due to individuals playing games, enjoying their experience, and logging on to Board Game Geek to share their pleasurable experience. 

With this set of code, we were attempting to find the top 10 reviewers, based on the total number of reviews, and determine the average rating they gave amongst their total reviews. In order to parse this information from the data, we used similar steps from the previous example. We grouped the data by specific users, then filtered to only show the top 10 reviews in descending order by the number of reviews. The individual with the most in the top 10 had 6471 while the indiv	udal with the lowest had 3992, with an average of 5187.8 reviews. Regarding ratings, the averages ranged from 5.359719 to 9.179932, averaging out to an average rating of 6.71409. This is interesting because it shows that the individuals in the top 10 must give genuine thought to their reviews, basing them on certain criteria over thousands of reviews. 
